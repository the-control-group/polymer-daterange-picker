<link rel="import" href="../polymer/polymer.html">
<polymer-element name="polymer-moment-timezone" attributes="moment bowerSrc momentDefaultTimezone">
	<script>
		Polymer({
			publish: {
				moment: null,
				momentDefaultTimezone: null,
				bowerSrc: '..',
			},
			attached: function() {
				var poly = this;
				function loadScript(url) {
					var script = document.createElement('script');
					script.type = 'text/javascript';
					script.src = url;
					document.body.appendChild(script);
				}
				// Load Moment
				if( typeof window.moment == 'undefined' ) {
					loadScript(this.bowerSrc+"/moment/min/moment.min.js");
				}
				// Load Moment Timezone
				function loadMomentTz() {
					if( window.moment && typeof window.moment.tz == 'undefined' ) {
						loadScript(this.bowerSrc+"/moment-timezone/builds/moment-timezone-with-data.min.js");
					}
				}
				// Set Moment to polymer attribute
				function setMomentAttribute() {
					if( window.moment && window.moment.tz ) {
						if( this.momentDefaultTimezone ) {
							moment.tz.setDefault( this.momentDefaultTimezone );
						}
						this.moment = moment;
					} else {
						setMomentAttribute();
					}
				}
				this.async(loadMomentTz,null,100);
				this.async(setMomentAttribute,null,500);
			},
		});
	</script>
</polymer-element>